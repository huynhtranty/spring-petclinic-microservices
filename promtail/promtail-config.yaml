server:
  http_listen_port: 9080
  grpc_listen_port: 0

clients:
  - url: http://loki:3100/loki/api/v1/push

positions:
  filename: /tmp/positions.yaml

scrape_configs:
  - job_name: kubernetes-pods
    pipeline_stages:
      - docker: {}  # decode logs from JSON docker format (stdout/stderr)

    static_configs:
      - targets:
          - localhost
        labels:
          job: varlogs
          __path__: /var/lib/docker/containers/*/*.log
          __docker_container_name__: ""

    relabel_configs:
      # Extract the container ID from log file path
      - source_labels: [__path__]
        regex: /var/lib/docker/containers/([a-f0-9]+)/*.log
        target_label: container_id

      # Set job label = docker container name (cleaned)
      - source_labels: [__docker_container_name__]
        regex: '/?(.*)'
        target_label: job

      # Optional: Keep container name as label
      - source_labels: [__docker_container_name__]
        regex: '/?(.*)'
        target_label: container

      # Optional: Add instance label = hostname
      - replacement: ${HOSTNAME}
        target_label: instance